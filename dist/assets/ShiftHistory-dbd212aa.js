import{r,a as l,j as e,w as f,x as j,y as N,z as p,A as b,U as v}from"./index-084b20c5.js";import{C as g}from"./calendar-0f9c51bc.js";const y=()=>{const[c,h]=r.useState([]),[i,o]=r.useState(!0),[a,n]=r.useState({prefix:"",startDate:"",endDate:""});r.useEffect(()=>{d();const t=l.channel("rso-history").on("postgres_changes",{event:"*",schema:"public",table:"rso"},d).subscribe();return()=>{l.removeChannel(t)}},[a]);const d=async()=>{o(!0);let t=l.from("rso").select("*").order("created_at",{ascending:!1});a.prefix&&(t=t.ilike("unit_prefix",`%${a.prefix}%`)),a.startDate&&(t=t.gte("created_at",a.startDate)),a.endDate&&(t=t.lte("created_at",a.endDate));const{data:s,error:u}=await t;u||h(s||[]),o(!1)},x=t=>typeof t=="number"?t:Array.isArray(t)?t.length:0,m=t=>typeof t=="string"?t:typeof t=="number"?`R$ ${t}`:"-";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-black/40 p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 bg-black/20 p-2 rounded border border-white/5",children:[e.jsx(f,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{placeholder:"Buscar por prefixo...",value:a.prefix,onChange:t=>n(s=>({...s,prefix:t.target.value})),className:"bg-transparent border-none text-white focus:outline-none w-full text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 p-2 rounded border border-white/5",children:[e.jsx(g,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",className:"bg-transparent text-white text-xs border-none focus:outline-none",value:a.startDate,onChange:t=>n(s=>({...s,startDate:t.target.value}))}),e.jsx("span",{className:"text-gray-400 text-xs",children:"até"}),e.jsx("input",{type:"date",className:"bg-transparent text-white text-xs border-none focus:outline-none",value:a.endDate,onChange:t=>n(s=>({...s,endDate:t.target.value}))})]})]}),e.jsx("div",{className:"rounded-md border border-white/10 overflow-hidden bg-[#1a1a1a]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-black/60 border-b border-white/10 text-gray-400 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Data"}),e.jsx("th",{className:"p-4",children:"Prefixo"}),e.jsx("th",{className:"p-4",children:"Autor"}),e.jsx("th",{className:"p-4 text-center",children:"Armas"}),e.jsx("th",{className:"p-4 text-center",children:"Drogas"}),e.jsx("th",{className:"p-4 text-center",children:"Detidos"}),e.jsx("th",{className:"p-4 text-right",children:"Dinheiro"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:i?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8",children:"Carregando..."})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum RSO encontrado."})}):c.map(t=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4 text-gray-300",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"p-4 font-bold text-[#5FD068]",children:t.unit_prefix}),e.jsx("td",{className:"p-4 text-gray-400",children:t.author}),e.jsx("td",{className:"p-4 text-center",children:x(t.weapons)}),e.jsx("td",{className:"p-4 text-center",children:typeof t.drugs=="number"?t.drugs:"-"}),e.jsx("td",{className:"p-4 text-center",children:t.detained}),e.jsx("td",{className:"p-4 text-right font-mono text-xs",children:m(t.marked_money)})]},t.id))})]})})})]})},_=()=>{const[c,h]=r.useState([]),[i,o]=r.useState([]);r.useState(!0);const[a,n]=r.useState({user:"",startDate:"",endDate:""});r.useEffect(()=>{d(),x();const t=l.channel("history-realtime").on("postgres_changes",{event:"*",schema:"public",table:"bate_ponto"},d).on("postgres_changes",{event:"*",schema:"public",table:"stage_evaluation"},x).subscribe();return()=>{l.removeChannel(t)}},[a]);const d=async()=>{let t=l.from("bate_ponto").select("*, users(full_name, username)").order("created_at",{ascending:!1});a.user&&(t=t.ilike("started_by",`%${a.user}%`)),a.startDate&&(t=t.gte("start_time",a.startDate)),a.endDate&&(t=t.lte("start_time",a.endDate));const{data:s}=await t;h(s||[])},x=async()=>{let t=l.from("stage_evaluation").select("*").order("created_at",{ascending:!1});a.user&&(t=t.ilike("trainee_name",`%${a.user}%`)),a.startDate&&(t=t.gte("created_at",a.startDate)),a.endDate&&(t=t.lte("created_at",a.endDate));const{data:s}=await t;o(s||[])},m=t=>{if(!t)return"Em andamento";const s=Math.floor(t/3600),u=Math.floor(t%3600/60);return`${s}h ${u}m`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-black/40 p-4 rounded-lg border border-white/10 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 bg-black/20 p-2 rounded border border-white/5",children:[e.jsx(f,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{placeholder:"Buscar (Nome/Autor)...",value:a.user,onChange:t=>n(s=>({...s,user:t.target.value})),className:"bg-transparent border-none text-white focus:outline-none w-full text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 p-2 rounded border border-white/5",children:[e.jsx(g,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",className:"bg-transparent text-white text-xs border-none focus:outline-none",value:a.startDate,onChange:t=>n(s=>({...s,startDate:t.target.value}))}),e.jsx("span",{className:"text-gray-400 text-xs",children:"até"}),e.jsx("input",{type:"date",className:"bg-transparent text-white text-xs border-none focus:outline-none",value:a.endDate,onChange:t=>n(s=>({...s,endDate:t.target.value}))})]})]}),e.jsxs(j,{defaultValue:"shifts",className:"w-full",children:[e.jsxs(N,{className:"bg-slate-900 border border-slate-800 w-full flex justify-start",children:[e.jsx(p,{value:"shifts",className:"flex-1 md:flex-none",children:"Histórico de Ponto"}),e.jsx(p,{value:"rso",className:"flex-1 md:flex-none",children:"Histórico RSO"}),e.jsx(p,{value:"evaluations",className:"flex-1 md:flex-none",children:"Avaliações"})]}),e.jsx(b,{value:"shifts",className:"space-y-6",children:e.jsx("div",{className:"rounded-md border border-white/10 overflow-hidden bg-[#1a1a1a]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-black/60 border-b border-white/10 text-gray-400 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Membro"}),e.jsx("th",{className:"p-4",children:"Viatura"}),e.jsx("th",{className:"p-4",children:"Início"}),e.jsx("th",{className:"p-4",children:"Duração"}),e.jsx("th",{className:"p-4",children:"Iniciado Por"}),e.jsx("th",{className:"p-4",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-500",children:"Nenhum registro."})}):c.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-[#5FD068]"}),e.jsx("span",{className:"font-medium text-white",children:((s=t.users)==null?void 0:s.full_name)||"Desconhecido"})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"text-[#5FD068] font-mono font-bold border border-[#5FD068]/30 px-2 py-1 rounded bg-[#5FD068]/10",children:t.vehicle_prefix})}),e.jsx("td",{className:"p-4 text-gray-300",children:new Date(t.start_time).toLocaleString()}),e.jsx("td",{className:"p-4 font-mono",children:t.final_duration||m(t.duration_seconds)}),e.jsx("td",{className:"p-4 text-gray-400 text-xs",children:t.started_by}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded ${t.status==="completed"?"bg-green-900/50 text-green-200":"bg-blue-900/50 text-blue-200"}`,children:t.status==="completed"?"Finalizado":"Em Andamento"})})]},t.id)})})]})})})}),e.jsx(b,{value:"rso",children:e.jsx(y,{})}),e.jsx(b,{value:"evaluations",children:e.jsx("div",{className:"rounded-md border border-white/10 overflow-hidden bg-[#1a1a1a]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-black/60 border-b border-white/10 text-gray-400 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Estagiário"}),e.jsx("th",{className:"p-4",children:"Viatura"}),e.jsx("th",{className:"p-4",children:"Nota Final"}),e.jsx("th",{className:"p-4",children:"Avaliador"}),e.jsx("th",{className:"p-4",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"Nenhuma avaliação encontrada."})}):i.map(t=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4 font-bold text-white",children:t.trainee_name}),e.jsx("td",{className:"p-4 font-mono text-[#5FD068]",children:t.vehicle_prefix}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`font-bold ${Number(t.final_grade)>=7?"text-green-500":"text-red-500"}`,children:t.final_grade})}),e.jsx("td",{className:"p-4 text-gray-400",children:t.evaluator_name}),e.jsx("td",{className:"p-4 text-gray-500 text-xs",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})})})})]})]})};export{_ as default};
