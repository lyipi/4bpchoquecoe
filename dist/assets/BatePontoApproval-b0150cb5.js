import{u as N,r,a as m,j as e,m as b,f as _,B as u}from"./index-084b20c5.js";import{C as w,a as y}from"./circle-x-ff72a381.js";const C=s=>s?new Date(s).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",A=()=>{const{toast:s}=N(),[n,x]=r.useState([]),[v,d]=r.useState(!0);r.useEffect(()=>{i()},[]);const i=async()=>{d(!0);const{data:t,error:a}=await m.from("bate_ponto").select("*").order("created_at",{ascending:!1});a?s({title:"Erro",description:"Erro ao carregar pontos",variant:"destructive"}):x(t||[]),d(!1)},l=async(t,a)=>{let o={approval_status:a};if(a==="rejected"&&t.status==="in_progress"){const c=new Date().toISOString(),g=new Date(t.started_at),p=new Date(c)-g,j=Math.floor(p/(1e3*60*60)),h=Math.floor(p/(1e3*60)%60);o={...o,status:"completed",ended_at:c,final_duration:`${j}h ${h}m`}}if(a==="approved"&&t.status!=="completed"){s({title:"Ação bloqueada",description:"Não é possível aprovar um ponto ainda em andamento.",variant:"destructive"});return}const{error:f}=await m.from("bate_ponto").update(o).eq("id",t.id);f?s({title:"Erro",description:"Falha ao atualizar o ponto",variant:"destructive"}):(s({title:"Sucesso",description:a==="approved"?"Ponto aprovado com sucesso.":t.status==="in_progress"?"Ponto rejeitado e encerrado automaticamente.":"Ponto rejeitado com sucesso."}),i())};return v?e.jsx("div",{className:"text-white",children:"Carregando Pontos..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Aprovação de Ponto Eletrônico"}),e.jsxs("div",{className:"grid gap-4",children:[n.length===0&&e.jsx("p",{className:"text-[#a8a9ad]",children:"Nenhum registro de ponto encontrado."}),n.map(t=>e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-black/40 border border-[#a8a9ad]/20 rounded-lg p-4 flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded uppercase font-bold ${t.approval_status==="approved"?"bg-green-900 text-green-200":t.approval_status==="rejected"?"bg-red-900 text-red-200":"bg-yellow-900 text-yellow-200"}`,children:t.approval_status==="pending"?"Pendente":t.approval_status==="approved"?"Aprovado":"Rejeitado"}),e.jsx("span",{className:"text-[#5FD068] font-bold",children:t.vehicle_prefix})]}),e.jsxs("p",{className:"text-white text-sm",children:[e.jsx("span",{className:"text-[#a8a9ad]",children:"Duração:"})," ",t.final_duration||"Em andamento"]}),e.jsxs("div",{className:"text-xs text-[#a8a9ad] mt-1",children:["Guarnição:"," ",Object.values(t.members||{}).map(a=>a.name).join(", ")]}),e.jsxs("div",{className:"text-xs text-[#a8a9ad] mt-1 flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Início: ",C(t.created_at)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.approval_status==="pending"&&e.jsxs(e.Fragment,{children:[t.status==="completed"&&e.jsxs(u,{size:"sm",onClick:()=>l(t,"approved"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Aprovar"]}),e.jsxs(u,{size:"sm",variant:"destructive",onClick:()=>l(t,"rejected"),children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Rejeitar"]})]})})]},t.id))]})]})};export{A as default};
