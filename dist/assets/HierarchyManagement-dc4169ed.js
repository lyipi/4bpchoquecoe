import{g as C,u as A,r as l,a as h,j as e,W as O,X as E,B as T,P as y,Y as D,Z as k}from"./index-084b20c5.js";const P=[{id:"superiores",title:"Oficiais Superiores",ranks:["Coronel","Tenente Coronel","Tenente-Coronel","Major"]},{id:"intermediarios",title:"Oficiais Intermediários",ranks:["Capitão"]},{id:"subalternos",title:"Oficiais Subalternos",ranks:["1º Tenente","2º Tenente","1° Tenente","2° Tenente"]},{id:"especiais",title:"Praças Especiais",ranks:["Aspirante a Oficial","Aspirante-a-Oficial","Aluno Oficial"]},{id:"graduados",title:"Praças Graduados",ranks:["Sub Tenente","Subtenente","1º Sargento","2º Sargento","3º Sargento","Aluno a Sargento"]},{id:"pracas",title:"Praças",ranks:["Cabo","Soldado","Soldado 1ª Classe","Soldado 2ª Classe","Soldado 1 Classe","Soldado 2 Classe","Aluno Soldado"]}],M=()=>{const{hasRole:x}=C(),m=x(["Administrativos","Super Administrativo"]),{toast:n}=A(),[u,p]=l.useState([]),[f,j]=l.useState(!0),[i,N]=l.useState(""),[g,o]=l.useState(!1),[b,d]=l.useState(null);l.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:s,error:t}=await h.from("hierarchy").select("*").order("name");if(t)throw t;p(s||[])}catch{n({title:"Erro",description:"Não foi possível carregar o efetivo.",variant:"destructive"})}finally{j(!1)}},S=async s=>{if(console.log("Attempting to delete officer:",s),!(s!=null&&s.id)){console.error("No officer ID found");return}if(window.confirm(`Tem certeza que deseja excluir ${s.full_name||s.name}? Esta ação não pode ser desfeita.`))try{console.log("Sending delete request to Supabase for ID:",s.id);const{error:t}=await h.from("hierarchy").delete().eq("id",s.id);if(t)throw console.error("Supabase delete error:",t),t;console.log("Officer deleted successfully"),n({title:"Sucesso",description:"Militar removido do efetivo."}),await c()}catch(t){console.error("Delete operation caught error:",t),n({title:"Erro",description:"Não foi possível excluir o militar. "+(t.message||""),variant:"destructive"})}else console.log("Deletion cancelled by user")},v=u.filter(s=>(s.full_name||s.name||"").toLowerCase().includes(i.toLowerCase())||(s.serial||"").includes(i)),w=P.map(s=>{const t=v.filter(a=>a.rank&&s.ranks.some(r=>r.toLowerCase()===a.rank.toLowerCase()));return t.sort((a,r)=>(a.full_name||a.name).localeCompare(r.full_name||r.name)),{...s,officers:t}});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center bg-[#111] p-6 rounded-lg border border-white/5",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-[#5FD068]"})," Gestão de Efetivo"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(E,{placeholder:"Filtrar por nome ou serial...",value:i,onChange:s=>N(s.target.value),className:"w-64 bg-black/50 border-white/10"}),e.jsxs(T,{onClick:()=>{d(null),o(!0)},className:"bg-[#5FD068] text-black hover:bg-[#4ab854] font-bold",children:[e.jsx(y,{className:"w-4 h-4 mr-2"})," Adicionar"]})]})]}),e.jsx("div",{className:"space-y-8",children:f?e.jsx("p",{className:"text-center text-gray-500 py-12",children:"Carregando..."}):w.map(s=>s.officers.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[#5FD068] uppercase pl-4 border-l-4 border-[#5FD068]",children:s.title}),e.jsx("div",{className:"bg-slate-900/30 border border-slate-800/50 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm min-w-[1200px]",children:[e.jsx("thead",{className:"bg-black/40 text-xs font-bold text-slate-400 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"CPF"}),e.jsx("th",{className:"p-3",children:"Serial"}),e.jsx("th",{className:"p-3",children:"Nome"}),e.jsx("th",{className:"p-3",children:"Discord"}),e.jsx("th",{className:"p-3 text-center",children:"Patente"}),e.jsx("th",{className:"p-3 text-center",children:"Graduação"}),e.jsx("th",{className:"p-3 text-center",children:"Função"}),e.jsx("th",{className:"p-3 text-center",children:"Promoção"}),e.jsx("th",{className:"p-3 text-center",children:"Entrada"}),e.jsx("th",{className:"p-2 text-center",children:"CDD"}),e.jsx("th",{className:"p-2 text-center",children:"SAT-B"}),e.jsx("th",{className:"p-2 text-center",children:"T.B"}),e.jsx("th",{className:"p-2 text-center",children:"T.A"}),e.jsx("th",{className:"p-2 text-center",children:"MOD"}),e.jsx("th",{className:"p-2 text-center",children:"POP"}),e.jsx("th",{className:"p-2 text-center",children:"ABORD"}),e.jsx("th",{className:"p-3 text-center",children:"LAUREA"}),e.jsx("th",{className:"p-3 text-center",children:"Cursos"}),e.jsx("th",{className:"p-3 text-right",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800/30",children:s.officers.map((t,a)=>e.jsx(D,{officer:t,isAdmin:m,isEven:a%2===0,showActions:!0,onEdit:r=>{d(r),o(!0)},onDelete:S},t.id))})]})})})]},s.id))}),e.jsx(k,{isOpen:g,onClose:()=>o(!1),officerToEdit:b,onSave:c})]})};export{M as default};
