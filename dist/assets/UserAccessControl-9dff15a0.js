import{c as f,u as D,g as R,r as n,a as h,j as e,h as a,B as g,D as C,i as U,k as O,l as T,n as P,o as M,p as _,q as L,s as z,t as N,v as V}from"./index-084b20c5.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=f("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=f("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),B=()=>{const{toast:m}=D(),{currentUser:x}=R(),[d,u]=n.useState([]),[A,b]=n.useState(!0),[S,c]=n.useState(!1),[r,I]=n.useState(null),[t,j]=n.useState(""),[i,v]=n.useState(!1);n.useEffect(()=>{p();const s=h.channel("users_list_updates").on("postgres_changes",{event:"*",schema:"public",table:"users"},()=>{p()}).subscribe();return()=>{h.removeChannel(s)}},[]);const p=async()=>{d.length===0&&b(!0);try{const{data:s,error:o}=await h.from("users").select("*").order("created_at",{ascending:!1});if(o)throw o;u(s||[])}catch(s){console.error("Error loading users:",s),m({title:"Erro",description:"Não foi possível carregar a lista de usuários.",variant:"destructive"})}finally{b(!1)}},w=s=>{I(s),j(s.role||a.OPERATIONAL),c(!0)},y=async()=>{if(!r)return;v(!0),console.log(`Updating user ${r.id} (${r.username}) to role ${t}`);const s=[...d];u(o=>o.map(l=>l.id===r.id?{...l,role:t}:l));try{const{data:o,error:l}=await h.from("users").update({role:t}).eq("id",r.id).select();if(console.log("Update response:",o),l)throw console.error("Update error:",l),l;m({title:"Acesso atualizado com sucesso",description:`O usuário ${r.username} agora é ${t}.`,className:"bg-[#1a4d2e] border-none text-white"}),await p(),c(!1)}catch(o){console.error("Error updating role:",o),u(s),m({title:"Erro na atualização",description:`Falha ao atualizar o cargo: ${o.message||"Erro desconhecido"}`,variant:"destructive"})}finally{v(!1)}},E=s=>!(s===a.SUPER_ADMIN&&x.role!==a.SUPER_ADMIN),k=s=>{switch(s){case a.SUPER_ADMIN:return"bg-purple-900/50 text-purple-200 border-purple-800";case a.ADMINISTRATIVE:return"bg-red-900/50 text-red-200 border-red-800";default:return"bg-green-900/50 text-green-200 border-green-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(F,{className:"w-6 h-6 text-[#5FD068]"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Controle de Acesso de Usuários"})]}),e.jsx("div",{className:"bg-[#1a1a1a] rounded-xl border border-[#a8a9ad]/20 overflow-hidden shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-black/50 border-b border-[#a8a9ad]/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-medium text-[#a8a9ad]",children:"Usuário"}),e.jsx("th",{className:"p-4 text-sm font-medium text-[#a8a9ad]",children:"Nome Completo"}),e.jsx("th",{className:"p-4 text-sm font-medium text-[#a8a9ad]",children:"Permissão Atual"}),e.jsx("th",{className:"p-4 text-sm font-medium text-[#a8a9ad]",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-[#a8a9ad]/10",children:A&&d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-[#a8a9ad]",children:"Carregando..."})}):d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-[#a8a9ad]",children:"Nenhum usuário encontrado."})}):d.map(s=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4 text-white font-mono text-sm",children:s.username}),e.jsx("td",{className:"p-4 text-white text-sm",children:s.full_name}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded border font-medium ${k(s.role)}`,children:s.role||a.OPERATIONAL})}),e.jsx("td",{className:"p-4",children:E(s.role)&&s.id!==x.id&&e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>w(s),className:"border-[#5FD068]/30 hover:bg-[#5FD068] hover:text-black transition-colors",children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Gerenciar"]})})]},s.id))})]})})}),e.jsx(C,{open:S,onOpenChange:c,children:e.jsxs(U,{className:"bg-[#1a1a1a] border border-[#a8a9ad]/20 text-white sm:max-w-[425px]",children:[e.jsxs(O,{children:[e.jsx(T,{children:"Alterar Permissão de Acesso"}),e.jsxs(P,{className:"text-[#a8a9ad]",children:["Selecione o novo nível de acesso para ",e.jsx("span",{className:"text-white font-bold",children:r==null?void 0:r.username}),"."]})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-[#a8a9ad]",children:"Nível de Acesso"}),e.jsxs(M,{value:t,onValueChange:j,disabled:i,children:[e.jsx(_,{className:"w-full bg-black/50 border border-[#a8a9ad]/30 text-white focus:ring-[#5FD068]",children:e.jsx(L,{placeholder:"Selecione um cargo"})}),e.jsxs(z,{className:"bg-[#1a1a1a] border-[#a8a9ad]/20 text-white",children:[e.jsx(N,{value:a.OPERATIONAL,children:"Operacionais"}),e.jsx(N,{value:a.ADMINISTRATIVE,children:"Administrativos"}),x.role===a.SUPER_ADMIN&&e.jsx(N,{value:a.SUPER_ADMIN,children:"Super Administrativo"})]})]})]}),e.jsxs("div",{className:`text-xs p-3 rounded border ${t===a.OPERATIONAL?"bg-green-900/20 border-green-800/30 text-green-200":t===a.ADMINISTRATIVE?"bg-red-900/20 border-red-800/30 text-red-200":"bg-purple-900/20 border-purple-800/30 text-purple-200"}`,children:[e.jsxs("p",{className:"font-semibold mb-1",children:[t===a.OPERATIONAL&&"Acesso Padrão",t===a.ADMINISTRATIVE&&"Acesso de Comando",t===a.SUPER_ADMIN&&"Acesso Total (Root)"]}),e.jsxs("p",{className:"opacity-80",children:[t===a.OPERATIONAL&&"Usuário poderá registrar ponto, RSO e visualizar suas estatísticas.",t===a.ADMINISTRATIVE&&"Permite gerenciar usuários (exceto Super Admins), aprovar pontos e RSOs.",t===a.SUPER_ADMIN&&"Permissão irrestrita. Pode gerenciar todos os usuários e configurações do sistema."]})]})]}),e.jsxs(V,{children:[e.jsx(g,{variant:"outline",onClick:()=>c(!1),disabled:i,className:"bg-transparent border-[#a8a9ad]/30 text-[#a8a9ad] hover:text-white hover:bg-white/10",children:"Cancelar"}),e.jsx(g,{onClick:y,disabled:i,className:"bg-[#1a4d2e] hover:bg-[#5FD068] text-white hover:text-black",children:i?"Salvando...":"Salvar Alterações"})]})]})})]})};export{B as default};
